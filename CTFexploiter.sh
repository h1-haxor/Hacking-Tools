#!/bin/bash



# #Checking the connection with the target
# if [[ -z ping -c 1 $target_ip ]]; then
	
# fi

# Initial recon function
function intial_recon() {
	target_ip="$1"
	wordlist="/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt"
	output_file="$2"



	#Running nmap 
	echo "Running Nmap...."
	echo "Nmap Results: " >> $FILE
	nmap -sV -n -v $target_ip -oN $output_file > /dev/null 2>&1
	grep -E "open|filtered|Host|Nmap scan report" $output_file >> $FILE
	rm $output_file
	# mv $output_file.filtered "$output_file.txt"


	if grep -qE "80/tcp.open" || grep -qE "443/tcp.open" $FILE;then
		#Performing whatweb
		echo "Checking target's tech stack...."
		echo " " >> $FILE
		echo "whatweb results: " >> $FILE
		whatweb "http://$target_ip" >> $FILE
	fi

	#Performing directory bruetforcing
	echo "Performing directory bruetforcing...."
	echo " " >> $FILE
	echo "Directory bruetforcing result: " >> $FILE
	dirb "http://$target_ip" $wordlist -o "dirb.txt" &> /dev/null

	#Appending results
	cat "dirb.txt" >> $FILE
	rm "dirb.txt"

	#checking for FTP
	if grep -qE "21/tcp.open" $FILE; then
		nmap -sV -p 21 --script ftp-*.nse $target_ip -oN "ftp.txt"
		echo " " >> $FILE
		echo "FTP results: " >> $FILE
		grep -E "open|filtered|Host|Nmap scan report|PORT|STATE|SERVICE" ftp.txt >> $FILE
		rm "ftp.txt"
	fi

	#checking for NETBIOS

	
}

#Cryptography
function enumerate() {
	target_ip=$1
	
}



#main script

echo -n "Please enter target's name: "
read name
echo "01. Initial Recon"
echo "02. Cryptography"
echo "03. Fuzz it"
echo "04. Exit"
echo -n "Please enter the option number: "
read option
mkdir $name
cd $name
touch "final_report.txt"
FILE="final_report.txt"
echo -n "Please enter target's IP or domain: "
read ip


if [[ $option -eq 1 ]]; then
	
	intial_recon $ip $name

elif [[ $option -eq 2 ]]; then
 	
	enumerate $ip "$name"
elif [[ $option -eq 4 ]]; then
	exit 1

fi



cd ..